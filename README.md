# Dolibarr MoceanAPI module user documentation

## Contents
- [Installation](#installation)
- [Prerequisites](#prerequisites)
- [Features](#features)
    - [Send SMS Notification](#send-sms-notification)
        - [Configuration](#configuration)
    - [Send Invoice Reminder](#send-invoice-reminder)
        - [Reminder Prerequisite](#reminder-prerequisite)
            - [Set PHP timezone in server](#set-php-timezone-in-server)
            - [Setup Cron Job](#setup-cron-job)
        - [Send Reminder Configuration](#send-reminder-configuration)
- [Whitelist IP Address](#whitelist-ip-address)
- [Frequently Asked Questions](#faq)
- [Feature Request](#feature-request)
- [Feedback](#feedback)

## Installation

1. Download the latest version of MoceanAPI module [here](https://www.dolistore.com/en/modules/1615-MoceanAPI-Send-SMS.html)

2. Go to **Setup - Modules/Application** 

![image](https://user-images.githubusercontent.com/24620178/211969217-e9818635-96f7-452f-bc37-ae9985392246.png)

3. Search for **MoceanAPI** and activate the module.

![image](https://user-images.githubusercontent.com/24620178/211969856-63843fb5-ee2b-47b1-a623-84d47a9a504e.png)

4. Installation is now complete and you can access the module via **Top Navigation**

![image](https://user-images.githubusercontent.com/24620178/211970553-75594aec-c63f-4efb-b4b5-ba6c1f8efb75.png)

## Prerequisites
1. Before you can send SMS, you need a `MoceanAPI account`. Register an account [here](https://dashboard.moceanapi.com/register?fr=dolibarr) in 5 minutes or less
2. Navigate to `MoceanAPI module` in dolibarr and specify your `API Key`, `API Secret`, `Sender`(Your business name), `Default country` and `Active hour to send SMS reminder`. 
You can find your `API Credentials` [here](https://dashboard.moceanapi.com/user/apisetting)

![image](https://user-images.githubusercontent.com/24620178/211975339-73e80f70-bde2-49c5-895e-b400cd5401d6.png)

## Features
### Send SMS Notification
You can send SMS notifications based on specific events that occured in dolibarr.
For eg: `Send SMS when an invoice is validated`

#### Configuration
1. Navigate to **MoceanAPI** app via **Top Navigation**
2. Click on the module you'd like to configure. For eg: **Invoice** module
3. You can then configure the trigger for SMS notification. For eg: **Send SMS when Invoice is validated**

![image](https://user-images.githubusercontent.com/24620178/212219128-2d1e16cf-8ad0-4643-bc1a-2566631420e5.png)

4. Once you're satisfied with all the configurations, you can click on **Save SMS Setting** at the bottom of the page
5. Test the SMS notification by Validating an Invoice.
6. SMS sent information will be available in the **SMS Outbox**

### Send Invoice Reminder
#### Reminder Prerequisite

##### Set PHP timezone in server

1. `SSH` into your server
2. Modify your `php.ini` file

`nano /etc/php/7.4/apache2/php.ini`

![image](https://user-images.githubusercontent.com/24620178/212011885-cfcb833d-e624-4d7e-b95c-96e63cee00f2.png)

3. You may need to change the command based on the PHP version your server is using. For eg: if you're using `PHP Version 8.1` your command would be

`nano /etc/php/8.1/apache2/php.ini`

4. Look for **date.timezone** and set the timezone to your local timezone.

![image](https://user-images.githubusercontent.com/24620178/212012378-9900ad6e-1819-4f47-824a-ecb4df006c74.png)

5. Save the file and restart your web server

##### Setup Cron Job
1. Navigate to **Setup > Modules / Application** in Dolibarr and enable the **Scheduled Jobs** module and click on the **gear icon**

![image](https://user-images.githubusercontent.com/24620178/211984198-54038454-dfa5-4ccf-bca9-bb1058aa889d.png)

2. Generate a security key to launch the cronjob using a script.

![image](https://user-images.githubusercontent.com/24620178/211987517-b527472a-dfad-4a03-9e05-9c930ee8d13c.png)

3. Copy the command generated by dolibarr and replace the values according to your dolibarr installation

![image](https://user-images.githubusercontent.com/24620178/211988585-8caad972-3c62-4064-8bce-70bf3d1c3372.png)

4. Copy and paste the modified command into your cronjob entry in your server, in my case it would be

`*/5 * * * * /srv/dolibarr-16.0.0/scripts/cron/cron_run_jobs.php 715WIrfV14Blvdv4aQV26VMIrJwR4g2g admin > /srv/dolibarr-16.0.0/documents/cron_run_jobs.php.log`

**Note**: You may need to add `/path/to/php` infront of the script to run it successfully, the final code would be:

`*/5 * * * * /usr/bin/php /srv/dolibarr-16.0.0/scripts/cron/cron_run_jobs.php 715WIrfV14Blvdv4aQV26VMIrJwR4g2g admin > /srv/dolibarr-16.0.0/documents/cron_run_jobs.php.log`

5. Navigate to **Admin Tools > Scheduled Jobs** 

![image](https://user-images.githubusercontent.com/24620178/211984311-27ed7728-2c23-457c-8c2e-f9a9eee0db55.png)

6. If `Scheduled` is green color, your configuration is correct. If not, please recheck the steps above.

![image](https://user-images.githubusercontent.com/24620178/212039077-3ec2f108-0ad0-4b15-a01e-ba0381c994a2.png)

**Contact us if you require assistance**

#### Send Reminder Configuration
1. Navigate to `Invoice` module in `MoceanAPI` app.
2. Click on `Add Reminder`

![image](https://user-images.githubusercontent.com/24620178/211981406-f2fcf98c-8325-48de-9cfb-c0fdea46fbbe.png)

3. Configure the reminder criteria (when you want to send the reminder). You can personalise your SMS message using `keywords`

![image](https://user-images.githubusercontent.com/24620178/211981875-402938b9-0d52-4b29-ad21-e3b3d1844a84.png)

4. Click on `Save` once you're satisfied with your configuration

5. Enable the SMS notification and click on `Save SMS Setting` at the bottom of the page.

![image](https://user-images.githubusercontent.com/24620178/211982500-880cfd3a-9a5d-44f1-9d07-185cd0de7196.png)

## FAQ
1. Can I get Test Credits ?

You can get 20 FREE credits and credits are valid for 14 days. Subject to approval.

2. Can I send international messages?

Yes. We are an international SMS provider. You can send out SMS both locally and internationally based on our price list.

3. What is the maximum characters per SMS I can put into the message?

160 characters for a normal text message, 70 characters for a Unicode text message (Arabic, Chinese, and etc)

4. Is there a limit to how many numbers I can send at one time?

There is no limit on numbers to be sent in one go.

5. What format does my phone number need to be in?

Mobile phone numbers need to be entered in international formatting with the country code and without spaces, plus signs or leading zeros.

**Did not find what you're looking for ?**

Do raise a support ticket with our Support Team at [support@moceanapi.com](mailto:support@moceanapi.com).

## Feature Request
Do raise a support ticket with our Support Team at [support@moceanapi.com](mailto:support@moceanapi.com).

## Feedback
Send feedback to our Support Team at [support@moceanapi.com](mailto:support@moceanapi.com).
